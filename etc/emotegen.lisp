
;; Emotinomicon code generation helper

(defgeneric translate (cmd))

(defmethod translate ((cmd list))
  (ecase (first cmd)
    (push0 "ğŸ˜€")
    (push1 "ğŸ˜…")
    (push2 "ğŸ˜‰")
    (push3 "ğŸ˜")
    (push4 "ğŸ˜’")
    (push5 "ğŸ˜—")
    (push6 "ğŸ˜œ")
    (push7 "ğŸ˜¡")
    (push8 "ğŸ˜")
    (push9 "ğŸ˜†")
    (push10 "ğŸ”Ÿ")
    (push100 "ğŸ’¯")
    (add "â•")
    (sub "â–")
    (div "â—")
    (mul "âœ–")
    (input-char "â«")
    (output-char "â¬")
    (open-loop "âª")
    (close-loop "â©")
    (dup "ğŸ†™")
    (drop "ğŸ˜Š")
    (reverse-stack "ğŸ˜")
    (reverse-n "ğŸ˜“") ; DOESN'T WORK IN THE REFERENCE IMPLEMENTATION !!
    (pow "ğŸ˜˜")
    (log "ğŸ˜")
    (negate "ğŸ˜¢")
    (abs "ğŸ˜‚")
    (2n "ğŸ˜‡")
    (3n "â˜ºï¸")
    (4n "ğŸ˜")
    (n/2 "ğŸ˜”")
    (n/3 "ğŸ˜™")
    (n/4 "ğŸ˜")
    (n^2 "ğŸ˜£")
    (n^3 "ğŸ˜ƒ")
    (n^4 "ğŸ˜ˆ")
    (sqrt "ğŸ˜‹")
    (cbrt "ğŸ˜")
    (4rt "ğŸ˜•")
    (floor "ğŸ˜š")
    (ceil "ğŸ˜Ÿ")
    (round "ğŸ˜¤")
    (n+1 "ğŸ˜„")
    (n-1 "ğŸ‘¿")
    (mod "ğŸ˜Œ")
    (2^n "ğŸ˜‘")
    (3^n "ğŸ˜–")
    (4^n "ğŸ˜›")
    (fibo "ğŸ˜ ")
    (lucas "ğŸ˜¥")
    (pi "ğŸ˜¦")
    (e "ğŸ˜«")
    (phi "ğŸ˜°")
    (ln "ğŸ˜µ")
    (log10 "ğŸ˜º")
    (e^n "ğŸ˜¿")
    (10^n "ğŸ˜§")
    (pop-and-goto "ğŸ˜¬")
    (pop-and-modify-code "ğŸ˜±")
    (pop-and-get-code "ğŸ˜¶")
    (n%2 "ğŸ˜»")
    (rand "ğŸ™€")
    (output-num "ğŸ˜¨")
    (begin-quote "ğŸ˜­")
    (end-quote "ğŸ˜²")
    (factorial "ï¸â—")
    (if-then-else "ï¸â“")
    (skip "â•")
    (skip-if-true "â”")
    (double-factorial "â€¼")
    (skip-if-false "â‰")))

(defmethod translate ((cmd string))
  cmd)

(defmethod translate-all (cmd)
  (mapcar #'translate cmd))

(defun lit-string (body)
  `((begin-string)
    ,@body
    (end-string)))

(defun do-loop (body)
  `((open-loop)
    ,@body
    (close-loop)))

(defun do-while (body)
  (do-loop
    `(,@body
      (skip-if-false))))

;; Only supports numbers from 0 to 100
(defun push-num (n)
  (case n
    (0 '((push0)))
    (1 '((push1)))
    (2 '((push2)))
    (3 '((push3)))
    (4 '((push4)))
    (5 '((push5)))
    (6 '((push6)))
    (7 '((push7)))
    (8 '((push8)))
    (9 '((push9)))
    (10 '((push10)))
    (100 '((push100)))
    (t `((push10) ,@(push-num (- n 10)) (add)))))

;; Copies the Nth element on the stack
;;
;; (copy-nth 0) is equivalent to (dup)
;; (defun copy-nth (n)
;;   `(,@(push-num n)
;;     (reverse-n)
;;     (dup)
;;     ,@(push-num (1+ n))
;;     (reverse-n)
;;     ,@(push-num n)
;;     (reverse-n)
;;     ,@(push-num (1+ n))
;;     (reverse-n)))

(defun padding (n)
  (loop for i = 1 to n
        collect '(reverse-stack)))

(format t "~{~A~}~%"
        (translate-all `(,@(padding 20)
                         (

;; (format t "~{~A~}~%"
;;         (translate-all `(,@(push-num 10)
;;                          ,@(push-num 20)
;;                          ,@(push-num 30)
;;                          ,@(push-num 40)
;;                          ,@(push-num 50)
;;                          ,@(push-num 60)
;;                          ,@(copy-nth 2)
;;                          (output-num)
;;                          (output-num)
;;                          (output-num)
;;                          (output-num)
;;                          (output-num)
;;                          (output-num))))
